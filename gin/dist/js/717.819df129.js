"use strict";(self["webpackChunkchatroom"]=self["webpackChunkchatroom"]||[]).push([[717],{1241:function(e,t){t.A=(e,t)=>{const s=e.__vccOpts||e;for(const[o,i]of t)s[o]=i;return s}},3531:function(e,t,s){s.d(t,{A:function(){return c}});var o=s(6768);const i={id:"routeMask"};function n(e,t,s,n,l,r){return(0,o.uX)(),(0,o.CE)("div",i," 加载中... ")}var l={name:"routeMask",data(){return{routeMaskEle:null}},mounted(){this.routeMaskEle=document.querySelector("#routeMask"),setTimeout((()=>{this.routeMaskEle.classList.add("enter"),setTimeout((()=>{this.routeMaskEle.classList.add("waiting"),this.routeMaskEle.classList.remove("enter")}),300)}),100)}},r=s(1241);const a=(0,r.A)(l,[["render",n]]);var c=a},7717:function(e,t,s){s.r(t),s.d(t,{default:function(){return M}});var o=s(6768),i=s(4232),n=s(144);const l={class:"container"},r={class:"more"};var a={__name:"header",setup(e){const t=(0,n.KR)("望子成龙小学");return(e,s)=>{const n=(0,o.g2)("MoreFilled"),a=(0,o.g2)("el-icon");return(0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("h1",null,(0,i.v_)(t.value),1),(0,o.Lk)("div",r,[(0,o.bF)(a,null,{default:(0,o.k6)((()=>[(0,o.bF)(n)])),_:1})])])}}},c=s(1241);const u=(0,c.A)(a,[["__scopeId","data-v-7a6b02fa"]]);var d=u,m=(s(8992),s(3949),s(5130)),v=s(1219),f=s(9294);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function y(e,t){if("object"!=p(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var o=s.call(e,t||"default");if("object"!=p(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function h(e){var t=y(e,"string");return"symbol"==p(t)?t:t+""}function g(e,t,s){return(t=h(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class x{constructor(e,t,s,o,i){g(this,"type",{text:"text",image:"image",file:"file"}),g(this,"user",{id:"",name:"",level:0,avatar:"",title:"",titleColor:"",phone:""}),g(this,"quote",{from:this.user,type:"",context:"",time:""}),g(this,"fileContext",{Title:"",Context:""}),g(this,"requestType",{type:"",context:"",time:"",from:this.user,quote:this.quote}),this.setRequestType(e,t,s,o,i)}getResult(){return this.requestType}setUser(e){this.requestType.from=e}setQuote(e){this.requestType.quote.context=e.context,this.requestType.quote.type=e.type,this.requestType.quote.from=e.from,this.requestType.quote.time=e.time}setType(e){this.requestType.type=e}setContext(e){this.requestType.context=e}setTime(e){this.requestType.time=e}setRequestType(e,t,s,o,i){this.requestType.type=e,this.requestType.context=t,this.requestType.time=s,this.requestType.from=o,i&&(this.requestType.quote.context=i.context,this.requestType.quote.type=i.type,this.requestType.quote.from=i.from,this.requestType.quote.time=i.time)}static User(){return(new x).user}static Quote(){return(new x).quote}static Type(){return(new x).type}static FileContext(e,t){const s=(new x).fileContext;s.Title=e,s.Context=t;const o=JSON.stringify(s);return o}}const w={class:"container"},T={class:"input"};var b={__name:"footer",setup(e){const t=(0,n.KR)(""),s=(0,n.KR)(null),i={recently_used:"最近使用",smileys_people:"微笑与人物",animals_nature:"动物与自然",food_drink:"食物与饮料",activities:"活动",travel_places:"旅行与地点",objects:"物体",symbols:"符号",flags:"旗帜"},l=new x(x.Type().text,"",(new Date).toLocaleTimeString(),x.User(),s),r=(0,o.EW)((()=>{const e=JSON.parse(localStorage.getItem("chatRoomUserInfo"));return e})),a=()=>{const e=document.querySelector(".emojiBox"),t=document.querySelector(".emojiBoxMask");e.classList.add("show"),t.classList.add("show"),t.addEventListener("click",(()=>{e.classList.remove("show"),t.classList.remove("show")}))},c=e=>{const s=document.querySelector(".el-input__inner");s.focus();const o=s.selectionStart,i=s.selectionEnd;void 0!==o&&void 0!==i&&(t.value=s.value.substring(0,o)+e.i+s.value.substring(i))},u=async()=>{let e=await window.showOpenFilePicker({multiple:!0});e.forEach((async e=>{const t=await e.getFile();if(-1===t.type.indexOf("image")){const e=new FileReader;e.readAsDataURL(t),e.onload=async()=>{l.setRequestType(x.Type().file,x.FileContext(t.name,e.result),`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,r.value,s),f.A.post("/send",l.getResult())}}else{const e=new FileReader;e.readAsDataURL(t),e.onload=async()=>{l.setRequestType(x.Type().image,e.result,`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,r.value,s),f.A.post("/send",l.getResult())}}}))},d=()=>{""!==t.value?(l.setRequestType(x.Type().text,t.value,`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,r.value,s),f.A.post("/send",l.getResult()).then((()=>{t.value="",s.value=null;const e=document.querySelector(".emojiBox"),o=document.querySelector(".emojiBoxMask");e.classList.remove("show"),o.classList.remove("show")}))):v.nk.info("请输入内容")};return(e,s)=>{const n=(0,o.g2)("EmojiPicker"),l=(0,o.g2)("font-awesome-icon"),r=(0,o.g2)("el-input"),v=(0,o.g2)("Files"),f=(0,o.g2)("el-icon"),p=(0,o.g2)("el-button"),y=(0,o.g2)("Promotion");return(0,o.uX)(),(0,o.CE)(o.FK,null,[s[1]||(s[1]=(0,o.Lk)("div",{class:"emojiBoxMask"},null,-1)),(0,o.bF)(n,{native:!0,theme:"dark","display-recent":!0,"static-texts":{placeholder:"搜索表情",skinTone:"更换肤色"},"group-names":i,onSelect:c,class:"emojiBox"}),(0,o.Lk)("div",w,[(0,o.Lk)("form",{onSubmit:(0,m.D$)(d,["prevent"])},[(0,o.Lk)("div",T,[(0,o.bF)(r,{modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=e=>t.value=e)},{prefix:(0,o.k6)((()=>[(0,o.bF)(l,{icon:["fas","face-smile"],size:"lg",onClick:a,style:{cursor:"pointer"}})])),_:1},8,["modelValue"]),(0,o.bF)(p,{onClick:u,id:"moreBtn"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{size:"1.5em",color:"#fff"},{default:(0,o.k6)((()=>[(0,o.bF)(v)])),_:1})])),_:1}),(0,o.bF)(p,{onClick:d,id:"sendBtn"},{default:(0,o.k6)((()=>[(0,o.bF)(f,{size:"2em",color:"#fff"},{default:(0,o.k6)((()=>[(0,o.bF)(y)])),_:1})])),_:1})])],32)])],64)}}};const k=(0,c.A)(b,[["__scopeId","data-v-4316ed6a"]]);var q=k;const L={class:"newMsg"},S={class:"num"},_={class:"scrollToBtm"};var F={__name:"body",setup(e){const t=(0,o.EW)((()=>{const e=JSON.parse(localStorage.getItem("chatRoomUserInfo"));return e})),s=(0,n.KR)(0),l=e=>new Promise((t=>setTimeout(t,e))),r=async(e,s)=>{var o="";if(o=s.hasChildNodes()&&s.lastChild.getAttribute("userId")==e.from.id?e.from.id==t.value.id?`\n          <div class="msg myself" userId="${e.from.id}">\n            <div class="textBox">\n              <div class="time">${e.time}</div>\n              <div class="text">`+e.context+"</div>\n            </div>\n          </div>":`\n            <div class="msg" userId="${e.from.id}">\n              <div class="textBox">\n                <div class="text">`+e.context+`</div>\n                <div class="time">${e.time}</div>\n              </div>\n            </div>`:e.from.id==t.value.id?`\n          <div class="msg first myself" userId="${e.from.id}">\n            <div class="user">\n              <div class="level">Lv${e.from.level}</div>\n              <div class="title" style="background-color:${e.from.titleColor}">${e.from.title}</div>\n              <div class="name">${e.from.name}</div>\n            </div>\n            <div class="textBox">\n              <div class="time">${e.time}</div>\n              <div class="text">`+e.context+"</div>\n            </div>\n          </div>":`\n            <div class="msg first" userId="${e.from.id}">\n              <div class="user">\n                <div class="name">${e.from.name}</div>\n                <div class="title" style="background-color:${e.from.titleColor}">${e.from.title}</div>\n                <div class="level">Lv${e.from.level}</div>\n              </div>\n              <div class="textBox">\n                <div class="text">`+e.context+`</div>\n                <div class="time">${e.time}</div>\n              </div>\n            </div>`,"image"==e.type){o=o.replace('<div class="text">'+e.context+"</div>",`<img src="${e.context}">`),s.insertAdjacentHTML("beforeend",o);const t=s.lastElementChild.querySelectorAll("img");await t.forEach((t=>{t.addEventListener("click",(()=>{v.nk.info("调用外部应用打开图片"),f.A.post("/openImg",e)}))}))}else if("file"==e.type){o=o.replace('<div class="text">'+e.context+"</div>",`<div class="text file" addr="${e.context}"><div class="fileCont">${e.context}</div></div>`),s.insertAdjacentHTML("beforeend",o);const t=s.lastElementChild.querySelectorAll(".file");await t.forEach((t=>{t.style.padding="0",t.style.cursor="pointer";const s={title:t.innerText,Context:t.getAttribute("addr"),From:e.from};t.addEventListener("click",(()=>{v.nk.info("正在下载文件"),f.A.post("/download",s)}))}))}else s.insertAdjacentHTML("beforeend",o)};return(0,o.sV)((async()=>{const e=document.querySelector("#bodyContainer"),t=document.querySelector(".msgBox");f.A.post("/getHistory").then((s=>{s&&(s.length>100&&(s=s.slice(s.length-100,s.length)),console.log(s),s.forEach((e=>{r(e,t)})),e.style.scrollBehavior="unset",e.scrollTop=e.scrollHeight,e.style.scrollBehavior="smooth")}));const o=document.querySelector(".scrollToBtm"),i=document.querySelector("#sendBtn");o.style.left=i.offsetLeft+"px";const a=document.querySelector(".newMsg");for(a.style.left=e.clientWidth/2-a.clientWidth/2+"px",e.addEventListener("scroll",(()=>{const t=e.scrollTop+e.clientHeight>=e.scrollHeight-100;t?(a.classList.remove("show"),o.classList.remove("show"),s.value=0):a.classList.contains("show")||o.classList.add("show")})),a.addEventListener("click",(()=>{e.scrollTop=e.scrollHeight,a.classList.remove("show"),s.value=0})),o.addEventListener("click",(()=>{e.scrollTop=e.scrollHeight,o.classList.remove("show")}));;){const i=(0,n.KR)(null),a=await f.A.post("/get").catch((e=>i.value=e));if(i.value)await l(5e3);else{console.log(a.message),a.message.forEach((e=>{r(e,t)}));const i=e.scrollTop+e.clientHeight>=e.scrollHeight-100;if(i)e.scrollTop=e.scrollHeight-e.clientHeight;else{const e=document.querySelector(".newMsg");e.classList.add("show"),o.classList.remove("show"),s.value+=a.message.length}}}})),(e,t)=>{const n=(0,o.g2)("DArrowRight"),l=(0,o.g2)("el-icon");return(0,o.uX)(),(0,o.CE)(o.FK,null,[t[1]||(t[1]=(0,o.Lk)("div",{id:"bodyContainer"},[(0,o.Lk)("div",{class:"msgBox"})],-1)),(0,o.Lk)("div",L,[t[0]||(t[0]=(0,o.eW)(" 您有新消息 ")),(0,o.Lk)("span",S,(0,i.v_)(s.value),1)]),(0,o.Lk)("div",_,[(0,o.bF)(l,{size:"1.8em"},{default:(0,o.k6)((()=>[(0,o.bF)(n)])),_:1})])],64)}}};const $=F;var C=$,E=s(3531),A={__name:"room",setup(e){const t=()=>{f.A.post("/getUserInfo").then((e=>{console.log(e),localStorage.setItem("chatRoomUserInfo",JSON.stringify(e))}))};return t(),(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(E.A),(0,o.bF)(d),(0,o.bF)(q),(0,o.bF)(C)],64))}};const R=A;var M=R}}]);
//# sourceMappingURL=717.819df129.js.map