"use strict";(self["webpackChunkchatroom"]=self["webpackChunkchatroom"]||[]).push([[917],{1241:function(e,t){t.A=(e,t)=>{const s=e.__vccOpts||e;for(const[o,n]of t)s[o]=n;return s}},3531:function(e,t,s){s.d(t,{A:function(){return c}});var o=s(6768);const n={id:"routeMask"};function l(e,t,s,l,i,a){return(0,o.uX)(),(0,o.CE)("div",n," 加载中... ")}var i={name:"routeMask",data(){return{routeMaskEle:null}},mounted(){this.routeMaskEle=document.querySelector("#routeMask"),setTimeout((()=>{this.routeMaskEle.classList.add("enter"),setTimeout((()=>{this.routeMaskEle.classList.add("waiting"),this.routeMaskEle.classList.remove("enter")}),300)}),100)}},a=s(1241);const r=(0,a.A)(i,[["render",l]]);var c=r},8917:function(e,t,s){s.r(t),s.d(t,{default:function(){return S}});var o=s(6768),n=s(4232),l=s(144);const i={class:"container"},a={class:"more"};var r={__name:"header",setup(e){const t=(0,l.KR)("望子成龙小学");return(e,s)=>{const l=(0,o.g2)("MoreFilled"),r=(0,o.g2)("el-icon");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.Lk)("h1",null,(0,n.v_)(t.value),1),(0,o.Lk)("div",a,[(0,o.bF)(r,null,{default:(0,o.k6)((()=>[(0,o.bF)(l)])),_:1})])])}}},c=s(1241);const d=(0,c.A)(r,[["__scopeId","data-v-7a6b02fa"]]);var u=d,m=(s(8992),s(3949),s(5130)),v=s(1219),g=s(9294);const h={class:"container"},f={class:"input"};var p={__name:"footer",setup(e){const t=(0,l.KR)(""),s={recently_used:"最近使用",smileys_people:"微笑与人物",animals_nature:"动物与自然",food_drink:"食物与饮料",activities:"活动",travel_places:"旅行与地点",objects:"物体",symbols:"符号",flags:"旗帜"},n={Type:"text",Context:t.value,Time:(new Date).toLocaleTimeString(),From:"user"},i=(0,o.EW)((()=>{const e=JSON.parse(localStorage.getItem("chatRoomUserInfo"));return e})),a=()=>{const e=document.querySelector(".emojiBox"),t=document.querySelector(".emojiBoxMask");e.classList.add("show"),t.classList.add("show"),t.addEventListener("click",(()=>{e.classList.remove("show"),t.classList.remove("show")}))},r=e=>{const s=document.querySelector(".el-input__inner");s.focus();const o=s.selectionStart,n=s.selectionEnd;void 0!==o&&void 0!==n&&(t.value=s.value.substring(0,o)+e.i+s.value.substring(n))},c=async()=>{let e=await window.showOpenFilePicker({multiple:!0});e.forEach((async e=>{const t=await e.getFile();if(-1===t.type.indexOf("image")){n.Type="file";const e=new FileReader;e.readAsDataURL(t),e.onload=async()=>{n.Context=`{"Title": "${t.name}", "Context": "${e.result}"}`,n.Time=`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,n.From=i.value,g.A.post("/send",n)}}else{n.Type="image";const e=new FileReader;e.readAsDataURL(t),e.onload=async()=>{n.Context=e.result,n.Time=`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,n.From=i.value,g.A.post("/send",n)}}}))},d=()=>{""!==t.value?(n.Type="text",n.Context=t.value,n.Time=`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,n.From=i.value,g.A.post("/send",n).then((()=>{t.value="";const e=document.querySelector(".emojiBox"),s=document.querySelector(".emojiBoxMask");e.classList.remove("show"),s.classList.remove("show")}))):v.nk.info("请输入内容")};return(e,n)=>{const l=(0,o.g2)("EmojiPicker"),i=(0,o.g2)("font-awesome-icon"),u=(0,o.g2)("el-input"),v=(0,o.g2)("Files"),g=(0,o.g2)("el-icon"),p=(0,o.g2)("el-button"),k=(0,o.g2)("Promotion");return(0,o.uX)(),(0,o.CE)(o.FK,null,[n[1]||(n[1]=(0,o.Lk)("div",{class:"emojiBoxMask"},null,-1)),(0,o.bF)(l,{native:!0,theme:"dark","display-recent":!0,"static-texts":{placeholder:"搜索表情",skinTone:"更换肤色"},"group-names":s,onSelect:r,class:"emojiBox"}),(0,o.Lk)("div",h,[(0,o.Lk)("form",{onSubmit:(0,m.D$)(d,["prevent"])},[(0,o.Lk)("div",f,[(0,o.bF)(u,{modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=e=>t.value=e)},{prefix:(0,o.k6)((()=>[(0,o.bF)(i,{icon:["fas","face-smile"],size:"lg",onClick:a,style:{cursor:"pointer"}})])),_:1},8,["modelValue"]),(0,o.bF)(p,{onClick:c,id:"moreBtn"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{size:"1.5em",color:"#fff"},{default:(0,o.k6)((()=>[(0,o.bF)(v)])),_:1})])),_:1}),(0,o.bF)(p,{onClick:d,id:"sendBtn"},{default:(0,o.k6)((()=>[(0,o.bF)(g,{size:"2em",color:"#fff"},{default:(0,o.k6)((()=>[(0,o.bF)(k)])),_:1})])),_:1})])],32)])],64)}}};const k=(0,c.A)(p,[["__scopeId","data-v-93a44bf8"]]);var F=k;const L={class:"newMsg"},x={class:"num"},y={class:"scrollToBtm"};var w={__name:"body",setup(e){const t=JSON.parse(localStorage.getItem("chatRoomUserInfo")),s=(0,l.KR)(0),i=e=>new Promise((t=>setTimeout(t,e))),a=async(e,s)=>{var o="";if(o=s.hasChildNodes()&&s.lastChild.getAttribute("userId")==e.From.Id?e.From.Id==t.Id?`\n          <div class="msg myself" userId="${e.From.Id}">\n            <div class="textBox">\n              <div class="time">${e.Time}</div>\n              <div class="text">`+e.Context+"</div>\n            </div>\n          </div>":`\n            <div class="msg" userId="${e.From.Id}">\n              <div class="textBox">\n                <div class="text">`+e.Context+`</div>\n                <div class="time">${e.Time}</div>\n              </div>\n            </div>`:e.From.Id==t.Id?`\n          <div class="msg first myself" userId="${e.From.Id}">\n            <div class="user">\n              <div class="level">Lv${e.From.Level}</div>\n              <div class="title" style="background-color:${e.From.TitleColor}">${e.From.Title}</div>\n              <div class="name">${e.From.Name}</div>\n            </div>\n            <div class="textBox">\n              <div class="time">${e.Time}</div>\n              <div class="text">`+e.Context+"</div>\n            </div>\n          </div>":`\n            <div class="msg first" userId="${e.From.Id}">\n              <div class="user">\n                <div class="name">${e.From.Name}</div>\n                <div class="title" style="background-color:${e.From.TitleColor}">${e.From.Title}</div>\n                <div class="level">Lv${e.From.Level}</div>\n              </div>\n              <div class="textBox">\n                <div class="text">`+e.Context+`</div>\n                <div class="time">${e.Time}</div>\n              </div>\n            </div>`,"image"==e.Type)o=o.replace('<div class="text">'+e.Context+"</div>",`<img src="${e.Context}">`),s.innerHTML+=o;else if("file"==e.Type){o=o.replace('<div class="text">'+e.Context+"</div>",`<div class="text file" addr="${e.Context}">${e.Context}</div>`),s.innerHTML+=o;const t=s.querySelectorAll(".file");await t.forEach((t=>{t.style.cursor="pointer";const s={Title:t.innerText,Context:t.getAttribute("addr"),From:e.From};t.addEventListener("click",(()=>{v.nk.info("正在下载文件"),g.A.post("/download",s)}))}))}else s.innerHTML+=o};return(0,o.sV)((async()=>{const e=document.querySelector("#bodyContainer"),t=document.querySelector(".msgBox");g.A.post("/getHistory").then((s=>{s&&(s.length>100&&(s=s.slice(s.length-100,s.length)),s.forEach((e=>{a(e,t)})),e.style.scrollBehavior="unset",e.scrollTop=e.scrollHeight,e.style.scrollBehavior="smooth")}));const o=document.querySelector(".scrollToBtm"),n=document.querySelector("#sendBtn");o.style.left=n.offsetLeft+"px";const r=document.querySelector(".newMsg");for(r.style.left=e.clientWidth/2-r.clientWidth/2+"px",e.addEventListener("scroll",(()=>{const t=e.scrollTop+e.clientHeight>=e.scrollHeight-100;t?(r.classList.remove("show"),o.classList.remove("show"),s.value=0):r.classList.contains("show")||o.classList.add("show")})),r.addEventListener("click",(()=>{e.scrollTop=e.scrollHeight,r.classList.remove("show"),s.value=0})),o.addEventListener("click",(()=>{e.scrollTop=e.scrollHeight,o.classList.remove("show")}));;){const n=(0,l.KR)(null),r=await g.A.post("/get").catch((e=>n.value=e));if(n.value)await i(5e3);else{console.log(r.message),r.message.forEach((e=>{a(e,t)}));const n=e.scrollTop+e.clientHeight>=e.scrollHeight-100;if(n)e.scrollTop=e.scrollHeight-e.clientHeight;else{const e=document.querySelector(".newMsg");e.classList.add("show"),o.classList.remove("show"),s.value+=r.message.length}}}})),(e,t)=>{const l=(0,o.g2)("DArrowRight"),i=(0,o.g2)("el-icon");return(0,o.uX)(),(0,o.CE)(o.FK,null,[t[1]||(t[1]=(0,o.Lk)("div",{id:"bodyContainer"},[(0,o.Lk)("div",{class:"msgBox"})],-1)),(0,o.Lk)("div",L,[t[0]||(t[0]=(0,o.eW)(" 您有新消息 ")),(0,o.Lk)("span",x,(0,n.v_)(s.value),1)]),(0,o.Lk)("div",y,[(0,o.bF)(i,{size:"1.8em"},{default:(0,o.k6)((()=>[(0,o.bF)(l)])),_:1})])],64)}}};const T=w;var b=T,C=s(3531),$={__name:"room",setup(e){const t=()=>{g.A.post("/getUserInfo").then((e=>{console.log(e),localStorage.setItem("chatRoomUserInfo",JSON.stringify(e))}))};return t(),(e,t)=>((0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(C.A),(0,o.bF)(u),(0,o.bF)(F),(0,o.bF)(b)],64))}};const _=$;var S=_}}]);
//# sourceMappingURL=917.59a69eb3.js.map