{"version":3,"file":"js/917.59a69eb3.js","mappings":"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","sources":["webpack://chatroom/./node_modules/vue-loader/dist/exportHelper.js","webpack://chatroom/./src/components/routeMask.vue","webpack://chatroom/./src/components/routeMask.vue?d00e","webpack://chatroom/./src/components/header.vue","webpack://chatroom/./src/components/header.vue?3f13","webpack://chatroom/./src/components/footer.vue","webpack://chatroom/./src/components/footer.vue?1818","webpack://chatroom/./src/components/body.vue","webpack://chatroom/./src/components/body.vue?8bec","webpack://chatroom/./src/views/room.vue","webpack://chatroom/./src/views/room.vue?a230"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","<template>\r\n  <div id=\"routeMask\">\r\n    加载中...\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'routeMask',\r\n  data() {\r\n    return {\r\n      routeMaskEle: null\r\n    }\r\n  },\r\n  mounted() {\r\n    this.routeMaskEle = document.querySelector('#routeMask')\r\n    setTimeout(() => {\r\n      this.routeMaskEle.classList.add('enter')\r\n      setTimeout(() => {\r\n        this.routeMaskEle.classList.add('waiting')\r\n        this.routeMaskEle.classList.remove('enter')\r\n      }, 300)\r\n    }, 100)\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n#routeMask {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #2d2d2d;\r\n  z-index: 99;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  color: white;\r\n\r\n  &.enter {\r\n    transition: all 0.1s ease-in-out;\r\n    right: 100%;\r\n  }\r\n\r\n  &.waiting {\r\n    right: -100%;\r\n  }\r\n\r\n  &.leave {\r\n    transition: all 0.1s ease-in-out;\r\n    right: 0;\r\n  }\r\n}\r\n</style>","import { render } from \"./routeMask.vue?vue&type=template&id=eec74f86\"\nimport script from \"./routeMask.vue?vue&type=script&lang=js\"\nexport * from \"./routeMask.vue?vue&type=script&lang=js\"\n\nimport \"./routeMask.vue?vue&type=style&index=0&id=eec74f86&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <div class=\"container\">\r\n    <h1>{{ roomName }}</h1>\r\n    <div class=\"more\">\r\n      <el-icon><MoreFilled /></el-icon>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\n\r\nconst roomName = ref('望子成龙小学')\r\n</script>\r\n\r\n<style scoped>\r\n.container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  padding: 10px;\r\n  background-color: #1f1f1f;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: calc(100% - 20px);\r\n  z-index: 9999;\r\n  height: 4em;\r\n\r\n  h1 {\r\n    color: #cecece;\r\n    font-size: 1.5em;\r\n    font-weight: bold;\r\n  }\r\n\r\n  .more {\r\n    position: absolute;\r\n    right: 0.5em;\r\n    color: #cecece;\r\n    font-size: 1.5em;\r\n    padding: 0.5em;\r\n    height: 1em;\r\n    width: 1em;\r\n    cursor: pointer;\r\n    border-radius: 50%;\r\n    transition: all 0.2s ease-in-out;\r\n\r\n    &:hover {\r\n      background-color: #cecece;\r\n      color: #1f1f1f; \r\n    }\r\n  }\r\n}\r\n</style>","import script from \"./header.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./header.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./header.vue?vue&type=style&index=0&id=7a6b02fa&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-7a6b02fa\"]])\n\nexport default __exports__","<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <div class=\"emojiBoxMask\"></div>\r\n  <EmojiPicker :native=\"true\" :theme=\"'dark'\" :display-recent=\"true\"\r\n    :static-texts=\"{ placeholder: '搜索表情', skinTone: '更换肤色' }\" :group-names=\"emojiGroup\"\r\n    @select=\"insertEmoji\" class=\"emojiBox\" />\r\n  <div class=\"container\">\r\n    <form @submit.prevent=\"send\">\r\n      <div class=\"input\">\r\n        <el-input v-model=\"inputValue\">\r\n          <template #prefix>\r\n            <font-awesome-icon :icon=\"['fas', 'face-smile']\" size=\"lg\" @click=\"openEmoji\" style=\"cursor: pointer;\" />\r\n          </template>\r\n        </el-input>\r\n        <el-button @click=\"more\" id=\"moreBtn\"><el-icon size=\"1.5em\" color=\"#fff\">\r\n            <Files />\r\n          </el-icon></el-button>\r\n        <el-button @click=\"send\" id=\"sendBtn\"><el-icon size=\"2em\" color=\"#fff\">\r\n            <Promotion />\r\n          </el-icon></el-button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport request from '@/axios'\r\n\r\nconst inputValue = ref('')\r\n\r\nconst emojiGroup = {\r\n  \"recently_used\": \"最近使用\",\r\n  \"smileys_people\": \"微笑与人物\",\r\n  \"animals_nature\": \"动物与自然\",\r\n  \"food_drink\": \"食物与饮料\",\r\n  \"activities\": \"活动\",\r\n  \"travel_places\": \"旅行与地点\",\r\n  \"objects\": \"物体\",\r\n  \"symbols\": \"符号\",\r\n  \"flags\": \"旗帜\"\r\n}\r\n\r\nconst msg = {\r\n  Type: 'text',\r\n  Context: inputValue.value,\r\n  Time: new Date().toLocaleTimeString(),\r\n  From: 'user'\r\n}\r\n\r\nconst user = computed(() => {\r\n  const userInfo = JSON.parse(localStorage.getItem('chatRoomUserInfo'))\r\n  return userInfo\r\n})\r\n\r\nconst openEmoji = () => {\r\n  const emojiBox = document.querySelector('.emojiBox')\r\n  const emojiBoxMask = document.querySelector('.emojiBoxMask')\r\n  emojiBox.classList.add('show')\r\n  emojiBoxMask.classList.add('show')\r\n  emojiBoxMask.addEventListener('click', () => {\r\n    emojiBox.classList.remove('show')\r\n    emojiBoxMask.classList.remove('show')\r\n  })\r\n}\r\n\r\nconst insertEmoji = (emoji) => {\r\n  const inputEle = document.querySelector('.el-input__inner')\r\n  inputEle.focus()\r\n  const start = inputEle.selectionStart\r\n  const end = inputEle.selectionEnd\r\n  if (start === undefined || end === undefined) return\r\n  inputValue.value = inputEle.value.substring(0, start) + emoji.i + inputEle.value.substring(end)\r\n}\r\n\r\nconst more = async () => {\r\n  let fileHandles = await window.showOpenFilePicker({\r\n    multiple: true,\r\n  })\r\n  fileHandles.forEach(async (fileHandle) => {\r\n    const file = await fileHandle.getFile()\r\n    // 检测是否是图片\r\n    if (file.type.indexOf('image') === -1) {\r\n      msg.Type = 'file'\r\n      const reader = new FileReader()\r\n      reader.readAsDataURL(file)\r\n      reader.onload = async () => {\r\n        msg.Context = `{\"Title\": \"${file.name}\", \"Context\": \"${reader.result}\"}`\r\n        msg.Time = `${new Date().getMonth() + 1}.${new Date().getDate()} ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`\r\n        msg.From = user.value\r\n        request.post('/send', msg)\r\n      }\r\n    } else {\r\n      msg.Type = 'image'\r\n      // 获取文件base64内容\r\n      const reader = new FileReader()\r\n      reader.readAsDataURL(file)\r\n      reader.onload = async () => {\r\n        msg.Context = reader.result\r\n        msg.Time = `${new Date().getMonth() + 1}.${new Date().getDate()} ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`\r\n        msg.From = user.value\r\n        request.post('/send', msg)\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nconst send = () => {\r\n  if (inputValue.value === '') {\r\n    ElMessage.info('请输入内容')\r\n    return\r\n  }\r\n  msg.Type = 'text'\r\n  msg.Context = inputValue.value\r\n  msg.Time = `${new Date().getMonth() + 1}.${new Date().getDate()} ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`\r\n  msg.From = user.value\r\n  request.post('/send', msg).then(() => {\r\n    inputValue.value = ''\r\n    const emojiBox = document.querySelector('.emojiBox')\r\n    const emojiBoxMask = document.querySelector('.emojiBoxMask')\r\n    emojiBox.classList.remove('show')\r\n    emojiBoxMask.classList.remove('show')\r\n  })\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.emojiBoxMask {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: none;\r\n  z-index: 998;\r\n\r\n  &.show {\r\n    display: block;\r\n  }\r\n}\r\n\r\n.emojiBox {\r\n  position: absolute;\r\n  bottom: -5em;\r\n  left: 0;\r\n  width: 100%;\r\n  visibility: hidden;\r\n  opacity: 0;\r\n  z-index: 999;\r\n\r\n  transition: all 0.2s ease-in-out;\r\n\r\n  &.show {\r\n    visibility: visible;\r\n    opacity: 1;\r\n    bottom: 5em;\r\n  }\r\n}\r\n\r\n.container {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 10px;\r\n  background-color: #1f1f1f;\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: calc(100% - 20px);\r\n  z-index: 9999;\r\n  height: 4em;\r\n\r\n  form {\r\n    width: 100%;\r\n  }\r\n\r\n  .input {\r\n    width: 100%;\r\n    height: 3.5em;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    .el-input {\r\n      /* margin-right: 1em; */\r\n      width: 100%;\r\n      height: 2.8em;\r\n    }\r\n\r\n    .el-button {\r\n      margin: 0 0 0 0.5em;\r\n      padding: 0;\r\n      border: 0;\r\n      border-radius: 50%;\r\n\r\n      &#sendBtn {\r\n        height: 3.5em;\r\n        width: 3.5em;\r\n        min-width: 3.5em;\r\n        background-color: #74b8f7;\r\n        color: #1f1f1f;\r\n      }\r\n\r\n      &#moreBtn {\r\n        height: 3em;\r\n        width: 3em;\r\n        min-width: 3em;\r\n        background-color: #2d2d2d;\r\n        color: #fff;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>","import script from \"./footer.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./footer.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./footer.vue?vue&type=style&index=0&id=93a44bf8&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-93a44bf8\"]])\n\nexport default __exports__","<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <div id=\"bodyContainer\">\r\n    <div class=\"msgBox\">\r\n\r\n    </div>\r\n  </div>\r\n  <div class=\"newMsg\">\r\n    您有新消息\r\n    <span class=\"num\">{{ newMsgNum }}</span>\r\n  </div>\r\n  <div class=\"scrollToBtm\">\r\n    <el-icon size=\"1.8em\">\r\n      <DArrowRight />\r\n    </el-icon>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { onMounted, ref } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport request from '@/axios'\r\n\r\nconst user = JSON.parse(localStorage.getItem('chatRoomUserInfo'))\r\n\r\nconst newMsgNum = ref(0)\r\n\r\nconst sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\r\n// const msgsData = ref(\"\")\r\n\r\nconst addMsgHTML = async (msg, msgBoxEle) => {\r\n  var newHtml = \"\"\r\n  if (msgBoxEle.hasChildNodes() && msgBoxEle.lastChild.getAttribute(\"userId\") == msg.From.Id) {\r\n    if (msg.From.Id == user.Id) {\r\n      newHtml = `\r\n          <div class=\"msg myself\" userId=\"${msg.From.Id}\">\r\n            <div class=\"textBox\">\r\n              <div class=\"time\">${msg.Time}</div>\r\n              <div class=\"text\">`+ msg.Context + `</div>\r\n            </div>\r\n          </div>`\r\n    } else {\r\n      newHtml = `\r\n            <div class=\"msg\" userId=\"${msg.From.Id}\">\r\n              <div class=\"textBox\">\r\n                <div class=\"text\">`+ msg.Context + `</div>\r\n                <div class=\"time\">${msg.Time}</div>\r\n              </div>\r\n            </div>`\r\n    }\r\n  } else {\r\n    if (msg.From.Id == user.Id) {\r\n      newHtml = `\r\n          <div class=\"msg first myself\" userId=\"${msg.From.Id}\">\r\n            <div class=\"user\">\r\n              <div class=\"level\">Lv${msg.From.Level}</div>\r\n              <div class=\"title\" style=\"background-color:${msg.From.TitleColor}\">${msg.From.Title}</div>\r\n              <div class=\"name\">${msg.From.Name}</div>\r\n            </div>\r\n            <div class=\"textBox\">\r\n              <div class=\"time\">${msg.Time}</div>\r\n              <div class=\"text\">`+ msg.Context + `</div>\r\n            </div>\r\n          </div>`\r\n    } else {\r\n      newHtml = `\r\n            <div class=\"msg first\" userId=\"${msg.From.Id}\">\r\n              <div class=\"user\">\r\n                <div class=\"name\">${msg.From.Name}</div>\r\n                <div class=\"title\" style=\"background-color:${msg.From.TitleColor}\">${msg.From.Title}</div>\r\n                <div class=\"level\">Lv${msg.From.Level}</div>\r\n              </div>\r\n              <div class=\"textBox\">\r\n                <div class=\"text\">`+ msg.Context + `</div>\r\n                <div class=\"time\">${msg.Time}</div>\r\n              </div>\r\n            </div>`\r\n    }\r\n  }\r\n  if (msg.Type == 'image') {\r\n    newHtml = newHtml.replace(`<div class=\"text\">` + msg.Context + `</div>`, `<img src=\"${process.env.VUE_APP_API_ADDR}${msg.Context}\">`)\r\n    msgBoxEle.innerHTML += newHtml\r\n  } else\r\n    if (msg.Type == 'file') {\r\n      newHtml = newHtml.replace(`<div class=\"text\">` + msg.Context + `</div>`, `<div class=\"text file\" addr=\"${msg.Context}\">${msg.Context}</div>`)\r\n      msgBoxEle.innerHTML += newHtml\r\n      const fileEle = msgBoxEle.querySelectorAll('.file')\r\n      await fileEle.forEach(i => {\r\n        i.style.cursor = 'pointer'\r\n        const msgi = {\r\n          Title: i.innerText,\r\n          Context: i.getAttribute('addr'),\r\n          From: msg.From\r\n        }\r\n        i.addEventListener('click', () => {\r\n          ElMessage.info('正在下载文件')\r\n          request.post('/download', msgi)\r\n        })\r\n      })\r\n    } else {\r\n      msgBoxEle.innerHTML += newHtml\r\n    }\r\n  // msgsData.value += newHtml\r\n}\r\n\r\nonMounted(async () => {\r\n  const container = document.querySelector('#bodyContainer')\r\n  // 加载历史消息(只加载最后100条)\r\n  const msgBoxEle = document.querySelector('.msgBox')\r\n  request.post('/getHistory').then(res => {\r\n    if (res) {\r\n      if (res.length > 100) {\r\n        res = res.slice(res.length - 100, res.length)\r\n      }\r\n      res.forEach(i => {\r\n        addMsgHTML(i, msgBoxEle)\r\n      });\r\n      container.style.scrollBehavior = 'unset'\r\n      container.scrollTop = container.scrollHeight\r\n      container.style.scrollBehavior = 'smooth'\r\n    }\r\n  })\r\n\r\n  // 定义滚动到底部按钮的位置\r\n  const scrollToBtmEle = document.querySelector('.scrollToBtm')\r\n  const sendBtnEle = document.querySelector('#sendBtn')\r\n  scrollToBtmEle.style.left = sendBtnEle.offsetLeft + 'px'\r\n\r\n  // 定义新消息按钮的位置\r\n  const newMsgElement = document.querySelector('.newMsg')\r\n  newMsgElement.style.left = container.clientWidth / 2 - newMsgElement.clientWidth / 2 + 'px'\r\n\r\n  // 监听container滚动事件，滚动到底部时，隐藏newMsg和scrollToBtm\r\n  container.addEventListener('scroll', () => {\r\n    const isScrolledToBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 100\r\n    if (isScrolledToBottom) {\r\n      newMsgElement.classList.remove('show')\r\n      scrollToBtmEle.classList.remove('show')\r\n      newMsgNum.value = 0\r\n    } else if (!newMsgElement.classList.contains('show')) {\r\n      scrollToBtmEle.classList.add('show')\r\n    }\r\n  })\r\n\r\n  // 监听newMsg点击事件，滚动到底部\r\n  newMsgElement.addEventListener('click', () => {\r\n    container.scrollTop = container.scrollHeight\r\n    newMsgElement.classList.remove('show')\r\n    newMsgNum.value = 0\r\n  })\r\n\r\n  // 监听scrollToBtm点击事件，滚动到底部\r\n  scrollToBtmEle.addEventListener('click', () => {\r\n    container.scrollTop = container.scrollHeight\r\n    scrollToBtmEle.classList.remove('show')\r\n  })\r\n\r\n  // 监听新消息\r\n  for (; ;) {\r\n    const error = ref(null)\r\n    const res = await request.post('/get').catch(err => error.value = err)\r\n    if (error.value) {\r\n      await sleep(5000)\r\n    } else {\r\n      console.log(res.message)\r\n      res.message.forEach(i => {\r\n        addMsgHTML(i, msgBoxEle)\r\n      });\r\n\r\n      // 判断container内部是否已经滚动到最底部\r\n      const isScrolledToBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 100\r\n      if (isScrolledToBottom) {\r\n        container.scrollTop = container.scrollHeight - container.clientHeight\r\n      } else {\r\n        const newMsg = document.querySelector('.newMsg')\r\n        newMsg.classList.add('show')\r\n        scrollToBtmEle.classList.remove('show')\r\n        newMsgNum.value += res.message.length\r\n      }\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<style>\r\n#bodyContainer {\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: start;\r\n  align-items: start;\r\n  position: absolute;\r\n  width: 100%;\r\n  top: 5em;\r\n\r\n  height: calc(100vh - 10em);\r\n\r\n  overflow-y: scroll;\r\n  scroll-behavior: smooth;\r\n\r\n  &::-webkit-scrollbar {\r\n    width: 0.5em;\r\n  }\r\n\r\n  .msgBox {\r\n    display: flex;\r\n    flex-direction: column;\r\n    margin: 0;\r\n    padding: 0 1em;\r\n    width: calc(100% - 2em);\r\n\r\n    &:last-child {\r\n      margin-bottom: 1em;\r\n    }\r\n\r\n    .msg {\r\n      display: flex;\r\n      flex-direction: column;\r\n      width: 100%;\r\n      justify-content: start;\r\n      align-items: start;\r\n      margin-bottom: 0.2em;\r\n\r\n      &.myself {\r\n        align-items: end;\r\n\r\n        .textBox {\r\n          justify-content: end;\r\n        }\r\n\r\n        &.first .text {\r\n          border-top-right-radius: 0em;\r\n          border-top-left-radius: 1em;\r\n        }\r\n      }\r\n\r\n      &.first {\r\n        margin-top: 1em;\r\n\r\n        .text {\r\n          border-top-left-radius: 0em;\r\n        }\r\n      }\r\n\r\n      .user {\r\n        display: flex;\r\n        justify-content: start;\r\n        align-items: center;\r\n\r\n        .name {\r\n          text-align: start;\r\n          font-size: 0.9em;\r\n          margin-bottom: 0.2em;\r\n        }\r\n\r\n        .level {\r\n          text-align: start;\r\n          font-size: x-small;\r\n          color: #74b8f7;\r\n          font-weight: lighter;\r\n          margin: 0 0.25em;\r\n          user-select: none;\r\n        }\r\n\r\n        .title {\r\n          border-radius: 0.5em;\r\n          text-align: start;\r\n          font-size: 0.7em;\r\n          height: 80%;\r\n          color: #ffffff;\r\n          font-weight: bold;\r\n          margin: 0 0.25em;\r\n          padding: 0 0.3em;\r\n          user-select: none;\r\n        }\r\n      }\r\n\r\n      .textBox {\r\n        display: flex;\r\n      }\r\n\r\n      .text {\r\n        width: auto;\r\n        height: auto;\r\n        background-color: #1f1f1f;\r\n        border-radius: 1em;\r\n        font-size: medium;\r\n        /* border-bottom-right-radius: 1em;\r\n        border-bottom-left-radius: 1em; */\r\n        padding: 0.4em 0.8em;\r\n\r\n        white-space: normal;\r\n        word-wrap: break-word;\r\n        word-break: break-word;\r\n        text-align: start;\r\n      }\r\n\r\n      .time {\r\n        text-align: start;\r\n        display: flex;\r\n        height: 100%;\r\n        align-items: end;\r\n        margin: 0 0.4em;\r\n        margin-bottom: 0.2em;\r\n        font-size: x-small;\r\n        color: #888;\r\n        font-weight: lighter;\r\n        user-select: none;\r\n      }\r\n\r\n      img {\r\n        width: 60%;\r\n        border-radius: 1em;\r\n      }\r\n\r\n      /* .file {\r\n        cursor: pointer;\r\n      } */\r\n    }\r\n  }\r\n}\r\n\r\n.newMsg {\r\n  position: absolute;\r\n  bottom: 3em;\r\n  width: auto;\r\n  height: auto;\r\n  background-color: #1f1f1f;\r\n  border-radius: 1em;\r\n  padding: 0.4em 0.8em;\r\n  color: #888;\r\n  cursor: pointer;\r\n\r\n  display: flex;\r\n  flex-wrap: nowrap;\r\n  align-items: center;\r\n  justify-content: center;\r\n\r\n  transition: all 0.3s ease-in-out;\r\n  opacity: 0;\r\n  visibility: hidden;\r\n\r\n  &:hover {\r\n    background-color: #cecece;\r\n    color: #1f1f1f;\r\n  }\r\n\r\n  &.show {\r\n    opacity: 1;\r\n    bottom: 6em;\r\n    visibility: visible;\r\n  }\r\n\r\n  .num {\r\n    margin-left: 5px;\r\n    padding: 0 0.2em;\r\n    line-height: 1.5em;\r\n\r\n    display: block;\r\n    text-align: center;\r\n    background-color: #74b8f7;\r\n    color: #ffffff;\r\n    border-radius: 0.75em;\r\n    width: auto;\r\n    min-width: 1.1em;\r\n    height: 1.5em;\r\n    text-align: center;\r\n\r\n    transition: all 0.3s ease-in-out;\r\n  }\r\n}\r\n\r\n.scrollToBtm {\r\n  position: absolute;\r\n  bottom: 3em;\r\n  cursor: pointer;\r\n  transition: all 0.3s ease-in-out;\r\n  transform: rotate(90deg);\r\n  border-radius: 50%;\r\n\r\n  width: 3em;\r\n  height: 3em;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n\r\n  background-color: #74b8f7;\r\n\r\n  opacity: 0;\r\n  visibility: hidden;\r\n\r\n  &.show {\r\n    opacity: 1;\r\n    bottom: 6em;\r\n    visibility: visible;\r\n  }\r\n}\r\n</style>","import script from \"./body.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./body.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./body.vue?vue&type=style&index=0&id=b2ea8f12&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","<!-- eslint-disable vue/multi-word-component-names -->\r\n<template>\r\n  <routeMask />\r\n  <myheader />\r\n  <myfooter />\r\n  <mybody />\r\n</template>\r\n\r\n<script setup>\r\nimport myheader from '../components/header.vue'\r\nimport myfooter from '../components/footer.vue'\r\nimport mybody from '../components/body.vue'\r\nimport routeMask from '../components/routeMask.vue'\r\nimport request from '../axios'\r\n\r\n// import { onMounted } from 'vue'\r\n// import FastClick from 'fastclick'\r\n// onMounted(async () => {\r\n//   FastClick.attach(document.body)\r\n// })\r\nconst getUserInfo = () => {\r\n  request.post('/getUserInfo').then(res => {\r\n    console.log(res)\r\n    localStorage.setItem('chatRoomUserInfo', JSON.stringify(res))\r\n  })\r\n}\r\ngetUserInfo()\r\n\r\n\r\n</script>","import script from \"./room.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./room.vue?vue&type=script&setup=true&lang=js\"\n\nconst __exports__ = script;\n\nexport default __exports__"],"names":["exports","sfc","props","target","__vccOpts","key","val","id","_createElementBlock","_hoisted_1","name","data","routeMaskEle","mounted","this","document","querySelector","setTimeout","classList","add","remove","__exports__","render","roomName","ref","inputValue","emojiGroup","msg","Type","Context","value","Time","Date","toLocaleTimeString","From","user","computed","userInfo","JSON","parse","localStorage","getItem","openEmoji","emojiBox","emojiBoxMask","addEventListener","insertEmoji","emoji","inputEle","focus","start","selectionStart","end","selectionEnd","undefined","substring","i","more","async","fileHandles","window","showOpenFilePicker","multiple","forEach","file","fileHandle","getFile","type","indexOf","reader","FileReader","readAsDataURL","onload","result","getMonth","getDate","hour","minute","request","post","send","then","ElMessage","info","newMsgNum","sleep","delay","Promise","resolve","addMsgHTML","msgBoxEle","newHtml","hasChildNodes","lastChild","getAttribute","Id","Level","TitleColor","Title","Name","replace","innerHTML","fileEle","querySelectorAll","style","cursor","msgi","innerText","onMounted","container","res","length","slice","scrollBehavior","scrollTop","scrollHeight","scrollToBtmEle","sendBtnEle","left","offsetLeft","newMsgElement","clientWidth","isScrolledToBottom","clientHeight","contains","error","catch","err","console","log","message","newMsg","getUserInfo","setItem","stringify"],"sourceRoot":""}