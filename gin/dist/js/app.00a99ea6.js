(function(){"use strict";var e={7052:function(e,t,o){var n=o(5130),s=o(6768),r=o(4232),i=o(144);const l={class:"container"},a={class:"more"};var c={__name:"header",setup(e){const t=(0,i.KR)("望子成龙小学");return(e,o)=>{const n=(0,s.g2)("MoreFilled"),i=(0,s.g2)("el-icon");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("h1",null,(0,r.v_)(t.value),1),(0,s.Lk)("div",a,[(0,s.bF)(i,null,{default:(0,s.k6)((()=>[(0,s.bF)(n)])),_:1})])])}}},d=o(1241);const u=(0,d.A)(c,[["__scopeId","data-v-7a6b02fa"]]);var v=u,m=(o(8992),o(3949),o(1219)),f=(o(4114),o(4373)),g=o(1387);const p=[],h=(0,g.aE)({history:(0,g.Bt)(),routes:p});var y=h;const b=f.A.create({baseURL:""});var F=!1;b.interceptors.request.use((e=>{e.headers["Content-Type"]="application/json;charset=utf-8";let t=JSON.parse(localStorage.getItem("xm-user")||"{}");return e.headers["token"]=t.token||"",e}),(e=>(m.nk.error("无法连接至服务器"),Promise.reject(e)))),b.interceptors.response.use((e=>{let t=e.data;return"blob"===e.config.responseType||("401"===t.code&&(m.nk.error(t.msg),y.push("/login")),"string"===typeof t&&(t=t?JSON.parse(t):t)),t}),(e=>(F||(F=!0,404===e.response.status?m.nk.error("未知的请求接口"):500===e.response.status?m.nk.error("无法连接至服务器"):501===e.response.status?m.nk.error("文件接收失败"):(m.nk.error("无法连接至服务器"),console.error(e.message)),setTimeout((()=>{F=!1}),4e3),console.error(e.response)),Promise.reject(e))));var k=b;const w={class:"container"},T={class:"input"};var x={__name:"footer",setup(e){const t=(0,i.KR)(""),o={Type:"text",Context:t.value,Time:(new Date).toLocaleTimeString(),From:"user"},r=(0,s.EW)((()=>{const e=JSON.parse(localStorage.getItem("chatRoomUserInfo"));return e})),l=async()=>{let e=await window.showOpenFilePicker({multiple:!0});e.forEach((async e=>{const t=await e.getFile();-1===t.type.indexOf("image")?o.Type="file":o.Type="image";const n=new FileReader;n.readAsDataURL(t),n.onload=async()=>{o.Context=n.result,o.Time=`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,o.From=r.value,k.post("/send",o)}}))},a=()=>{""!==t.value?(o.Type="text",o.Context=t.value,o.Time=`${(new Date).getMonth()+1}.${(new Date).getDate()} ${(new Date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,o.From=r.value,k.post("/send",o).then((()=>{t.value=""}))):m.nk.info("请输入内容")};return(e,o)=>{const r=(0,s.g2)("el-input"),i=(0,s.g2)("Files"),c=(0,s.g2)("el-icon"),d=(0,s.g2)("el-button"),u=(0,s.g2)("Promotion");return(0,s.uX)(),(0,s.CE)("div",w,[(0,s.Lk)("form",{onSubmit:(0,n.D$)(a,["prevent"])},[(0,s.Lk)("div",T,[(0,s.bF)(r,{modelValue:t.value,"onUpdate:modelValue":o[0]||(o[0]=e=>t.value=e)},null,8,["modelValue"]),(0,s.bF)(d,{onClick:l,id:"moreBtn"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{size:"1.5em",color:"#fff"},{default:(0,s.k6)((()=>[(0,s.bF)(i)])),_:1})])),_:1}),(0,s.bF)(d,{onClick:a,id:"sendBtn"},{default:(0,s.k6)((()=>[(0,s.bF)(c,{size:"2em",color:"#fff"},{default:(0,s.k6)((()=>[(0,s.bF)(u)])),_:1})])),_:1})])],32)])}}};const L=(0,d.A)(x,[["__scopeId","data-v-2a9c2bdc"]]);var C=L;const I={class:"newMsg"},S={class:"num"},$={class:"scrollToBtm"};var _={__name:"body",setup(e){const t=JSON.parse(localStorage.getItem("chatRoomUserInfo")),o=(0,i.KR)(0),n=e=>new Promise((t=>setTimeout(t,e))),l=(e,o)=>{var n="";n=o.hasChildNodes()&&o.lastChild.getAttribute("userId")==e.From.Id?e.From.Id==t.Id?`\n          <div class="msg myself" userId="${e.From.Id}">\n            <div class="textBox">\n              <div class="time">${e.Time}</div>\n              <div class="text">`+e.Context+"</div>\n            </div>\n          </div>":`\n            <div class="msg" userId="${e.From.Id}">\n              <div class="textBox">\n                <div class="text">`+e.Context+`</div>\n                <div class="time">${e.Time}</div>\n              </div>\n            </div>`:e.From.Id==t.Id?`\n          <div class="msg first myself" userId="${e.From.Id}">\n            <div class="user">\n              <div class="level">Lv${e.From.Level}</div>\n              <div class="title" style="background-color:${e.From.TitleColor}">${e.From.Title}</div>\n              <div class="name">${e.From.Name}</div>\n            </div>\n            <div class="textBox">\n              <div class="time">${e.Time}</div>\n              <div class="text">`+e.Context+"</div>\n            </div>\n          </div>":`\n            <div class="msg first" userId="${e.From.Id}">\n              <div class="user">\n                <div class="name">${e.From.Name}</div>\n                <div class="title" style="background-color:${e.From.TitleColor}">${e.From.Title}</div>\n                <div class="level">Lv${e.From.Level}</div>\n              </div>\n              <div class="textBox">\n                <div class="text">`+e.Context+`</div>\n                <div class="time">${e.Time}</div>\n              </div>\n            </div>`,"image"==e.Type&&(n=n.replace('<div class="text">'+e.Context+"</div>",`<img src="${e.Context}">`)),o.innerHTML+=n};return(0,s.sV)((async()=>{const e=document.querySelector("#bodyContainer"),t=document.querySelector(".msgBox");k.post("/getHistory").then((o=>{o&&(o.length>100&&(o=o.slice(o.length-100,o.length)),o.forEach((e=>{l(e,t)})),e.style.scrollBehavior="unset",e.scrollTop=e.scrollHeight,e.style.scrollBehavior="smooth")}));const s=document.querySelector(".scrollToBtm"),r=document.querySelector("#sendBtn");s.style.left=r.offsetLeft+"px";const a=document.querySelector(".newMsg");for(a.style.left=e.clientWidth/2-a.clientWidth/2+"px",e.addEventListener("scroll",(()=>{const t=e.scrollTop+e.clientHeight>=e.scrollHeight-100;t?(a.classList.remove("show"),s.classList.remove("show"),o.value=0):a.classList.contains("show")||s.classList.add("show")})),a.addEventListener("click",(()=>{e.scrollTop=e.scrollHeight,a.classList.remove("show"),o.value=0})),s.addEventListener("click",(()=>{e.scrollTop=e.scrollHeight,s.classList.remove("show")}));;){const r=(0,i.KR)(null),a=await k.post("/get").catch((e=>r.value=e));if(r.value)await n(5e3);else{console.log(a.message),a.message.forEach((e=>{l(e,t)}));const n=e.scrollTop+e.clientHeight>=e.scrollHeight-100;if(n)e.scrollTop=e.scrollHeight-e.clientHeight;else{const e=document.querySelector(".newMsg");e.classList.add("show"),s.classList.remove("show"),o.value+=a.message.length}}}})),(e,t)=>{const n=(0,s.g2)("DArrowRight"),i=(0,s.g2)("el-icon");return(0,s.uX)(),(0,s.CE)(s.FK,null,[t[1]||(t[1]=(0,s.Lk)("div",{id:"bodyContainer"},[(0,s.Lk)("div",{class:"msgBox"})],-1)),(0,s.Lk)("div",I,[t[0]||(t[0]=(0,s.eW)(" 您有新消息 ")),(0,s.Lk)("span",S,(0,r.v_)(o.value),1)]),(0,s.Lk)("div",$,[(0,s.bF)(i,{size:"1.8em"},{default:(0,s.k6)((()=>[(0,s.bF)(n)])),_:1})])],64)}}};const O=_;var B=O,E={__name:"App",setup(e){const t=()=>{k.post("/getUserInfo").then((e=>{console.log(e),localStorage.setItem("chatRoomUserInfo",JSON.stringify(e))}))};return t(),(e,t)=>((0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.bF)(v),(0,s.bF)(C),(0,s.bF)(B)],64))}};const j=E;var D=j,H=o(5835),R=(o(4188),o(7477));const M=(0,n.Ef)(D);for(const[P,A]of Object.entries(R))M.component(P,A);M.use(H.A),M.use(y).mount("#app")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,o),r.exports}o.m=e,function(){var e=[];o.O=function(t,n,s,r){if(!n){var i=1/0;for(d=0;d<e.length;d++){n=e[d][0],s=e[d][1],r=e[d][2];for(var l=!0,a=0;a<n.length;a++)(!1&r||i>=r)&&Object.keys(o.O).every((function(e){return o.O[e](n[a])}))?n.splice(a--,1):(l=!1,r<i&&(i=r));if(l){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,s,r]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,r,i=n[0],l=n[1],a=n[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(s in l)o.o(l,s)&&(o.m[s]=l[s]);if(a)var d=a(o)}for(t&&t(n);c<i.length;c++)r=i[c],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},n=self["webpackChunkchatroom"]=self["webpackChunkchatroom"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[504],(function(){return o(7052)}));n=o.O(n)})();
//# sourceMappingURL=app.00a99ea6.js.map